<?php error_reporting(1);session_start();include_once '../inc/connection.php';include_once '../inc/head.php';$userid = $_SESSION['user_id']; $task_id=$_GET['task_id'];if (isset($_POST['update'])) {    extract($_REQUEST);    $user_updated_date= date("Y-m-d h:i:s");     $sql = "UPDATE `developer_tasks` SET `remarks`='$remarks',`status`='$status',`assignment`='$assignment',     `user_updated_date`='$user_updated_date' WHERE id='$task_id' ";    $result = mysqli_query($connection, $sql);    if ($result == 1) {        $_SESSION['result'] = '        <div class="alert alert-success fade in alert-dismissible" >        <a href="#" class="close" data-dismiss="alert" aria-label="close" title="close"></a>        <strong>Task </strong>   Updated Successfully.        </div>        ';        echo "<script>window.location.href='my-created-task-details.php?task_id=$task_id';</script>";        exit();    } else {        $_SESSION['result'] = '        <div class="alert alert-danger fade in alert-dismissible" >        <a href="#" class="close" data-dismiss="alert" aria-label="close" title="close"></a>        <strong>Error</strong>   Check number Need to be unique.        </div>        ';        echo "<script>window.location.href='my-created-task-details.php?task_id=$task_id';</script>";        //header('location:my-created-task-details.php.php?task_id='.$edit_id);        exit();    }}if (isset($_POST['add_request_status'])) {    extract($_REQUEST);    $request_status_date= date("Y-m-d h:i:s");    $sql = "UPDATE `developer_tasks` SET `remarks`='$remarks',`request_status`='$request_status',`request_status_date`='$request_status_date' WHERE id='$task_id' ";    $result = mysqli_query($connection, $sql);    if ($result == 1) {        $_SESSION['result'] = '        <div class="alert alert-success fade in alert-dismissible" >        <a href="#" class="close" data-dismiss="alert" aria-label="close" title="close"></a>        <strong>Task </strong>   Request Status Sent Successfully.        </div>        ';        echo "<script>window.location.href='my-created-task-details.php?task_id=$task_id';</script>";        exit();    } else {        $_SESSION['result'] = '        <div class="alert alert-danger fade in alert-dismissible" >        <a href="#" class="close" data-dismiss="alert" aria-label="close" title="close"></a>        <strong>Error</strong>   Check Again.        </div>        ';        echo "<script>window.location.href='my-created-task-details.php?task_id=$task_id';</script>";        //header('location:my-created-task-details.php.php?task_id='.$edit_id);        exit();    }}if (isset($_POST['send_remark']) && isset($_POST['remarks'])) {    extract($_REQUEST);    $user_id=$_SESSION['user_id'];    $created_time= date("Y-m-d h:i:s");    $sql = "INSERT INTO `task_remarks`(`task_id`, `user_id`, `remarks`,`created_time`) VALUES ('$task_id','$user_id','$remarks','$created_time')";    $result = mysqli_query($connection, $sql);    if ($result == 1) {        $_SESSION['result'] = '        <div class="alert alert-success fade in alert-dismissible" >        <a href="#" class="close" data-dismiss="alert" aria-label="close" title="close"></a>        <strong>Remarks </strong>   Added Successfully.        </div>        ';        echo "<script>window.location.href='my-created-task-details.php?task_id=$task_id';</script>";        exit();    } else {        $_SESSION['result'] = '        <div class="alert alert-danger fade in alert-dismissible" >        <a href="#" class="close" data-dismiss="alert" aria-label="close" title="close"></a>        <strong>Error</strong>   Try Again.        </div>        ';        echo "<script>window.location.href='my-created-task-details.php?task_id=$task_id';</script>";        //header('location:my-created-task-details.php.php?task_id='.$edit_id);        exit();    }}elseif(isset($_POST['send_remark'])){    $_SESSION['result'] = '        <div class="alert alert-danger fade in alert-dismissible" >        <a href="#" class="close" data-dismiss="alert" aria-label="close" title="close"></a>        <strong>Error</strong>  Add Remarks First.        </div>        ';}if (isset($_POST['projectt_status'])) {    extract($_REQUEST);    $user_updated_date= date("Y-m-d h:i:s");     $task_sql="SELECT developer_tasks.*,departments.department_name as department_name,users.name as  name, project_status.status_name as status_name    FROM developer_tasks INNER JOIN departments ON developer_tasks.department_id=departments.id INNER JOIN project_status ON project_status.id=developer_tasks.status  INNER JOIN users ON users.id=developer_tasks.task_manager  WHERE developer_tasks.id=$task_id";    $result = mysqli_query($connection, $task_sql);    $data = mysqli_fetch_assoc($result);       $delivery_date = date('Y-m-d', strtotime($data['delivery_date']));    if ($delivery_date >= date('Y-m-d') ) {        $sql = "UPDATE `developer_tasks` SET `status`='$status',`user_updated_date`='$user_updated_date'  WHERE id='$task_id' ";        $result = mysqli_query($connection, $sql);    }else{       $sql = "UPDATE `developer_tasks` SET `status`='$status',`late_completed_status` ='1', `user_updated_date`='$user_updated_date'  WHERE id='$task_id' ";        $result = mysqli_query($connection, $sql);    }        if ($result == 1) {        $_SESSION['result'] = '        <div class="alert alert-success fade in alert-dismissible" >        <a href="#" class="close" data-dismiss="alert" aria-label="close" title="close"></a>        <strong>Task </strong>     Status Updated Successfully.        </div>        ';        echo "<script>window.location.href='my-created-task-details.php?task_id=$task_id';</script>";        exit();    } else {        $_SESSION['result'] = '        <div class="alert alert-danger fade in alert-dismissible" >        <a href="#" class="close" data-dismiss="alert" aria-label="close" title="close"></a>        <strong>Error</strong>   Check Again.        </div>        ';        echo "<script>window.location.href='my-created-task-details.php?task_id=$task_id';</script>";        //header('location:my-created-task-details.php.php?task_id='.$edit_id);        exit();    }}?><body><div id="app" class="app">    <?php include_once '../inc/sidebar.php'; ?></div><div class="content-area">    <div class="container-fluid">        <div class="container-fluid">            <?php            echo $_SESSION['result'];            $_SESSION['result'] = null;            ?>            <?php            $task_id = $_GET['task_id'];            $task_sql="SELECT developer_tasks.*,departments.department_name as department_name,users.name as  name, project_status.status_name as status_name    FROM developer_tasks INNER JOIN departments ON developer_tasks.department_id=departments.id INNER JOIN project_status ON project_status.id=developer_tasks.status  INNER JOIN users ON users.id=developer_tasks.task_manager  WHERE developer_tasks.id=$task_id";            $result = mysqli_query($connection, $task_sql);            $data = mysqli_fetch_assoc($result);            ?>            <!-- Modal -->            <div id="myModal" class="modal fade" role="dialog">                <div class="modal-dialog modal-status">                    <form action="" method="POST">                    <!-- Modal content-->                    <div class="modal-content">                        <div class="modal-header">                            <button type="button" class="close" data-dismiss="modal">&times;</button>                            <h4 class="modal-title">Change Status Request</h4>                        </div>                        <div class="modal-body">                            <div>                                    <select class="form-control" name="request_status">                                        <option value="">Select Status</option>                                        <option value="1"  <?php if($data['request_status']==1){echo "selected";} ?>>Completed Request</option>                                        <option value="2"  <?php if($data['request_status']==2){echo "selected";} ?>>Date Extension Request</option>                                        <option value="3"  <?php if($data['request_status']==3){echo "selected";} ?>>Rejected Request</option>                                    </select>                            </div>                        </div>                        <div class="modal-footer">                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>                            <button type="submit" class="btn  btn-info" name="add_request_status">                                <i class="fa fa-floppy-o" aria-hidden="true"></i> Save                            </button>                        </div>                    </div>                    </form>                </div>            </div>            <div class="panel panel-default">                <div class="panel-heading">Task Details                    <?php   if($_SESSION['user_id']==$data['task_manager']){ ?>                    <button type="button" class="btn btn-info btn-sm pull-right" data-toggle="modal" data-target="#myModal">Change Status Request</button>                    <?php } ?>                </div>                <div class="panel-body">                    <table class="table table-striped table-bordered table-responsive detail">                        <tbody>                        <tr>                            <td>                                <p>Task Title:</p>                                <span class="base-color text-capitalize"><?php echo $data['title']; ?></span>                            </td>                            <td><p>Department Name:</p>                                <span class="badge badge-info"><?php echo $data['department_name']; ?></span>                            </td>                            <td>                                <p>Team Leader Name:</p>                                <span class="base-color text-capitalize"> <?php echo $data['name']; ?> </span>                            </td>                        </tr>                        <tr>                            <td>                                <p>Assigned By:</p>                                <span class="base-color text-capitalize">   <?php                                    $created_user=$data['created_user'];                                    $c_u_sql="SELECT name FROM   users  WHERE id=$created_user";                                    $g_user = mysqli_query($connection, $c_u_sql);                                    $userdata = mysqli_fetch_assoc($g_user);                                    echo $userdata['name'];                                    ?> </span>                            </td>                            <td class="status-badge"><p>Status:</p>                                <?php if($data['status']==1){                                    echo '<span class="badge badge-info"><i class="fa fa-eye" aria-hidden="true"></i> In Progress</span>';                                }else if($data['status']==2){                                    echo '<span class="badge badge-green"><i class="fa fa-eye" aria-hidden="true"></i> Complete</span>';                                }else if($data['status']==4){                                    echo '<span class="badge badge-red"><i class="fa fa-eye" aria-hidden="true"></i> Cancel </span>';                                }else if($data['status']==5){                                    echo '<span class="badge badge-orange"><i class="fa fa-eye" aria-hidden="true"></i> Extension </span>';                                                                    }                                ?>                                    <div style="float:right;margin-top: -30px;">                                         <p>Status Date</p>                                     <?php                                         if ($data['user_updated_date']) {                                            $user_updated_date = $data['user_updated_date'];                                            echo "<span> $user_updated_date</span>";                                        }                                     ?>                                    </div>                            </td>                            <td class="status-badge" rowspan="1">                                                                                                       <?php if($_SESSION['employee_role'] !=3){  ?>                                       <p>Team Leader Status:</p>                                       <?php if($data['request_status']!=0){ ?>                                           <?php if($data['request_status']==1){                                               echo '<span class="badge badge-green"> Complete Request</span>';                                           }else if($data['request_status']==2){                                               echo '<span class="badge badge-info"> Date Extension Request</span>';                                           }else if($data['request_status']==3) {                                               echo '<span class="badge badge-red"> Rejected Request</span>';                                           }                                           ?>                                       <?php }else{ ?>                                       <?php                                           echo "<span class='base-color'>Not Avaiable</span>";                                       } ?>                                   <?php }  ?>                                                                           <div style="float:right;margin-top: -30px;">                                             <p>Status Change Request Date</p>                                         <?php                                             if ($data['request_status_date']) {                                                $request_status_date = $data['request_status_date'];                                                echo "<span> $request_status_date</span>";                                            }                                         ?>                                        </div>                                                                                                                                 </td>                                                    </tr>                        <tr>                            <td>                                <p>Team Member:</p>                                <?php                                $array=$data['team_member'];                                $team_membersql ="SELECT name FROM `users` WHERE `id` IN($array)";                                $team_members_qlqueries=mysqli_query($connection, $team_membersql);                                while ($team_member_list = mysqli_fetch_assoc($team_members_qlqueries)) {                                    ?>                                    <span class="badge  badge-info"><i class="fa fa-user-o"></i> <?php echo $team_member_list['name']; ?></span>                                <?php   } ?>                            </td>                            <td>                                <p>Priority:</p>                                <?php if($data['priority']==1){                                    echo "<span class='badge badge-danger'><i class='fa fa-warning'></i> High";                                }elseif($data['priority']==2){                                    echo "<span class='badge badge-warning'><i class='fa fa-warning'></i> Medium";                                }elseif($data['priority']==3){                                    echo "<span class='badge badge-primary'><i class='fa fa-warning'></i> Low";                                }else{                                }                                ?> </span>                            </td>                            <td>                                <p>Amount:</p>                                <span class="base-color">&#2547;                                         <?php if($data['amount']){                                             echo $data['amount'];                                         }else{                                             echo "Not Defined";                                         }                                         ?> </span>                            </td>                        </tr>                        <tr>                            <td>                                <p>Assign Date:</p>                                <span class="base-color"><i class="fa fa-calendar-o" aria-hidden="true"></i> <?php echo date('jS   F Y', strtotime($data['assign_date']));  ?> </span>                            </td>                            <td>                                <p>Tentative  Delivery Date:</p>                                <span class="base-color"><i class="fa fa-calendar-o" aria-hidden="true"></i>  <?php echo date('jS   F Y', strtotime($data['delivery_date']));  ?>  </span>                            </td>                            <td>                                <p>Update Date:</p>                                <span class="base-color">                                    <i class="fa fa-calendar-o" aria-hidden="true"></i>                                      <?php                                      if($data['user_updated_date']){                                          echo date('jS   F Y', strtotime($data['user_updated_date']));                                      }else{                                          echo " Not Avaiable Yet";                                      }   ?>                                </span>                            </td>                        </tr>                        <?php                            if ($data['module_or_project']!='') {                                                              ?>                                                   <tr>                            <td>                                <p>Project Status</p>                                <span class="badge badge-info"><i class="fa fa-eye" aria-hidden="true"></i> <?php if($data['module_or_project']=='1'){                                    echo "Module";                                }elseif ($data['module_or_project']=='2') {                                   echo "Full Project";                                }  ?></span>                            </td>                        </tr>                        <?php                         }                        ?>                        <tr>                            <td colspan="3">                                <p>Assignment Detail:</p>                                 <span class="base-color" style=" word-break: break-all !important;"><?php echo $data['assignment']; ?></span>                            </td>                        </tr>                        </tbody>                    </table>                    <div class="row">                                            <div class="col-md-12"><div class="col-md-6"></div>                        <div class="col-md-6">                        <div class="row">                        <?php   if($_SESSION['user_id']==$data['created_user'] || $_SESSION['employee_role']==1){ ?>                         <?php if($data['status']!=2 || $_SESSION['employee_role']==1){  ?>                        <form action="" method="POST">                        <div class="col-md-9">                         <select class="form-control" name="status">                                         <option value="1"  <?php if($data['status']==1){echo "selected";} ?>>In Progress</option>                                        <option value="2"  <?php if($data['status']==2){echo "selected";} ?>>Completed </option>                                        <option value="4"  <?php if($data['status']==4){echo "selected";} ?>>Cancel</option>                                        <option value="5"  <?php if($data['status']==5){echo "selected";} ?>>Extension</option>                                    </select>                        </div>                        <div class="col-md-3">                          <button type="submit" class="btn  btn-info btn-block pull-right" name="projectt_status">                                <i class="fa fa-floppy-o" aria-hidden="true"></i> Save                            </button>                        </div>                        </form>                                                <?php } } ?>                        </div>                                                                                                                                                                           </div>                                                      <?php                            $sql_remarks = "SELECT * FROM `task_remarks` INNER JOIN users  ON task_remarks.user_id = users.id   WHERE task_id=$task_id ORDER BY created_time ASC";                            $remarks_result = mysqli_query($connection, $sql_remarks);                           $counter=0;                            while ($remark = mysqli_fetch_assoc($remarks_result)) {                            ?>                                <section class="comment-list">                                    <!-- First Comment -->                                                                        <article class="row">                                        <div class="col-md-1 col-sm-1 hidden-xs">                                            <figure class="thumbnail">                                                <img class="img-responsive" src="http://www.tangoflooring.ca/wp-content/uploads/2015/07/user-avatar-placeholder.png" />                                            </figure>                                        </div>                                        <div class="col-md-11 col-sm-11">                                            <div class="panel <?php  if($counter%2==0) //ADDED THIS LINE    echo "panel-info"; //ADDED THIS LINE else     //ADDED THIS LINE   echo "panel-warning";  //ADDED THIS LINE?> arrow left">                                                <div class="panel-body">                                                    <header class="text-left">                                                        <div class="comment-user"><i class="fa fa-user"></i> <?php echo $remark['name']; ?></div>                                                        <time class="comment-date"  ><i class="fa fa-clock-o"></i> <?php    echo date('jS   F Y h:i', strtotime($remark['created_time'])); ?> </time>                                                    </header>                                                    <div class="comment-post base-color">                                                        <p>                                                            <?php echo $remark['remarks']; ?>                                                        </p>                                                    </div>                                                    <!--   <p class="text-right"><a href="#" class="btn btn-default btn-sm"><i class="fa fa-reply"></i> reply</a></p>-->                                                </div>                                            </div>                                        </div>                                    </article>                                </section>                            <?php $counter++;}?>                        </div>                        <div class="col-md-12">                            <form action="" method="POST">                                <?php   if($data['task_manager'] ==$_SESSION['user_id'] || $data['created_user'] ==$_SESSION['user_id']){ ?>                               <?php if($data['status']!=2){  ?>                                    <div class="form-group row">                                        <label for="name" class="col-md-12 col-form-label ">Remarks</label>                                        <div class="col-md-12">                                            <textarea class="form-control summernote" name="remarks"><?php echo $data['remarks'];  ?></textarea>                                        </div>                                    </div>                                    <div class="form-group row mb-0 text-center">                                        <div class="col-md-12">                                            <button type="submit" class="btn  btn-info" name="send_remark">                                                &nbsp;&nbsp;&nbsp;<i class="fa fa-paper-plane-o" aria-hidden="true"></i> Send&nbsp;&nbsp;&nbsp;                                            </button>                                        </div>                                    </div>                                <?php }} ?>                            </form>                        </div>                    </div>                </div>            </div>        </div>        <script>        </script>    </div></div></div><?phpinclude_once '../inc/footer.php';?></body></html>